name: Download Waha Image with Arch Check

on:
  workflow_dispatch:

jobs:
  pull-and-save:
    runs-on: ubuntu-latest

    steps:
      - name: 🐳 Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: 🧰 Create output directory
        run: mkdir -p output

      - name: 📥 Attempt to pull ARM tag (arm-2025.10.3)
        id: pull-arm
        run: |
          IMAGE_ARM="devlikeapro/waha:arm-2025.10.3"
          if docker pull ${IMAGE_ARM}; then
            echo "PULLED_ARM=true" >> $GITHUB_OUTPUT
            echo "Pulled ${IMAGE_ARM}"
          else
            echo "PULLED_ARM=false" >> $GITHUB_OUTPUT
            echo "Failed to pull ${IMAGE_ARM}"
          fi

      - name: 🗜 Save image to TAR (if ARM pulled)
        if: steps.pull-arm.outputs Pulled_ARM == 'true'
        run: |
          IMAGE_ARM="devlikeapro/waha:arm-2025.10.3"
          docker save ${IMAGE_ARM} -o output/waha-arm-2025.10.3.tar

      - name: 🧭 Fallback message (if ARM not available)
        if: steps.pull-arm.outputs.Pulled_ARM != 'true'
        run: |
          echo "The requested ARM tag could not be pulled on an amd64 runner. Check for an amd64-compatible tag or use an ARM runner."
