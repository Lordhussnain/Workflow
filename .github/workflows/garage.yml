name: Download Garage Docker Image

on:
  workflow_dispatch:

jobs:
  download:
    name: Download and Save Image as TAR
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”§ Install skopeo
        run: |
          sudo apt update -y
          sudo apt install -y skopeo

      - name: ðŸ“¦ Create output directory
        run: mkdir -p output

      - name: ðŸ“¥ Pull and save dxflrs/garage:v2.1.0 as TAR
        run: |
          IMAGE="dxflrs/garage:v2.1.0"
          OUTPUT_PATH="output/garage-v2.1.0.tar"
          echo "Downloading $IMAGE and saving as $OUTPUT_PATH"
          skopeo copy docker://$IMAGE docker-archive:$OUTPUT_PATH

      - name: ðŸ“¤ Upload TAR file as artifact
        uses: actions/upload-artifact@v4
        with:
          name: garage-v2-1-0-image
          path: output/garage-v2.1.0.tar
