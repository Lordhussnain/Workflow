name: Download Waha ARM Docker Image

on:
  workflow_dispatch:

jobs:
  download:
    name: Download and Save Image as TAR
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”§ Set up Docker (buildx)
        uses: docker/setup-buildx-action@v2

      - name: ðŸ“¦ Create output directory
        run: |
          mkdir -p output

      - name: ðŸ“¥ Pull ARM image (arm-2025.10.3)
        id: pull-arm
        run: |
          IMAGE="devlikeapro/waha:arm-2025.10.3"
          echo "Attempting to pull $IMAGE"
          if docker pull $IMAGE; then
            echo "PULLED_ARM=true" >> $GITHUB_OUTPUT
            echo "Pulled ${IMAGE}"
          else
            echo "PULLED_ARM=false" >> $GITHUB_OUTPUT
            echo "Failed to pull ${IMAGE}"
          fi

      - name: ðŸ—œ Save image to TAR (ARM tag)
        if: steps.pull-arm.outputs.PULLED_ARM == 'true'
        run: |
          IMAGE="devlikeapro/waha:arm-2025.10.3"
          OUTPUT_PATH="output/waha-arm-2025.10.3.tar"
          echo "Saving ${IMAGE} to ${OUTPUT_PATH}"
          docker save ${IMAGE} -o "${OUTPUT_PATH}"

      - name: ðŸ’¬ Arm tag unavailable message
        if: steps.pull-arm.outputs.PULLED_ARM != 'true'
        run: |
          echo "ARM tag could not be pulled on this runner (amd64)."
          echo "Consider using an amd64-compatible tag or an ARM64 runner. Refer to the image registry for available tags."

      - name: ðŸ“¤ Upload TAR file as artifact
        if: steps.pull-arm.outputs.PULLED_ARM == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: waha-arm-tar
          path: output/waha-arm-2025.10.3.tar
